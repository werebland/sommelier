{"version":3,"file":"static/webpack/static/development/pages/restaurant.js.d7e6593a0e2711c92cf0.hot-update.js","sources":["webpack:///./pages/restaurant.js"],"sourcesContent":["import React, { Component } from 'react';\nimport Head from 'next/head'\nimport styled from 'styled-components';\nimport posed, { PoseGroup } from 'react-pose';\nimport _ from 'lodash'\nimport base from '../config'\nimport firestore from 'firebase/firestore'\nimport Profile from '../components/Profile'\nimport Search from '../components/Search'\nimport DishCard from '../components/DishCard'\nimport Swiper from '../components/Swiper'\n\nconst RestaurantWrapper = styled.div`\n  width: 100%;\n  height: 100%;\n  padding: 0;\n  margin: 0;\n  background: #f7f7f7;\n`;\n\nconst ActionButton = styled.a`\n  position: fixed;\n  top: 16px;\n  right: 16px;\n  height: 40px;\n  padding: 0 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  overflow: hidden;\n  background: #FFFFFF;\n  box-shadow: 0 2px 16px -2px rgba(0,0,0,0.32);\n  cursor: pointer;\n  text-decoration: none;\n  font-size: 1rem;\n  font-weight: 400;\n  color: #0f0f0f;\n`;\n\nconst Scroller = styled.div`\n  width: 100%;\n  height: 100%;\n  min-height: 100vh;\n  margin-top: 200px;\n  background: transparent;\n\n  & .sticky-events--sentinel {\n      left: 0;\n      position: absolute;\n      right: 0;\n      visibility: hidden;\n  }\n\n  & .sticky-events--sentinel-top {\n      position: relative;\n  }\n`;\n\nconst DishCards = styled.div`\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-flow: column nowrap;\n  padding: 0 16px;\n  box-sizing: border-box;\n`;\n\nconst DishCardsFilters = styled.ul`\n  width: 100%;\n  max-width: 100vw;\n  overflow: scroll;\n  padding: 0 16px 0 16px;\n  box-sizing: border-box;\n  margin: 0 0 16px 0;\n  display: flex;\n  flex-flow: row nowrap;\n  position: relative;\n  z-index: 4;\n`;\n\nconst DishCardsFilter = styled.li`\n  list-style: none;\n  margin-right: 8px;\n  font-size: 1.25rem;\n  font-weight: 400;\n  color: ${props => props.active ? '#0f0f0f' : '#9f9f9f'};\n  cursor: pointer;\n`;\n\nconst DishCardContainer = posed.div({\n\n})\n\nconst PosedDishCard = posed.article({\n  pressable: true,\n  enter: {\n    opacity: 1,\n  },\n  exit: {\n    opacity: 0,\n  },\n  init: {\n    scale: 1,\n    boxShadow: '0px 2px 16px -2px rgba(0,0,0,0.32)',\n  },\n  press: {\n    scale: 0.99,\n    boxShadow: '0px 2px 8px -2px rgba(0,0,0,0.32)',\n  },\n})\n\nconst StyledPosedDishCard = styled(PosedDishCard)`\n  margin-bottom: 16px;\n  scale: 1;\n  transform-origin: center !important;\n  border-radius: 4px;\n  background: transparent;\n`;\n\nconst SwiperContainer = posed.div({\n  enter: {\n    x: '0vw',\n  },\n  exit: {\n    x: '100vw',\n  },\n  init: {\n    x: '100vw',\n  }\n})\n\nconst StyledSwiperContainer = styled(SwiperContainer)`\n  width: 100vw;\n  height: 100vh;\n  position: fixed;\n  transform: translateX(100vw);\n  top: 0;\n  z-index: 8888;\n`;\n\nclass Restaurant extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      activeDish: \"\",\n      activeFilter: 'popular',\n      families: [],\n      dishes: [],\n      filteredDishes: [],\n      isSearching: false,\n      isSticky: false,\n    };\n    this.actionButton = React.createRef()\n  }\n\n  static async getInitialProps({ query }) {\n    const { username } = query\n    console.log(username);\n    let restaurants = await base.get('restaurants', {\n      context: this,\n      query: (ref) => ref.where('username', '==', username),\n      withIds: true,\n    }).then(data => {\n      return data\n    }).catch(err => {\n      console.log(err);\n    })\n    let restaurant = restaurants[0]\n    return { restaurant,  query }\n  }\n\n  componentDidMount() {\n    const actionButtonWidth = this.actionButton.current.offsetWidth\n\n    this.fetchDishes()\n    if (window) {\n      window.addEventListener('scroll', this.handleScroll);\n    }\n  }\n\n  componentWillUnmount(){\n    window.removeEventListener('scroll', this.handleScroll);\n  }\n\n  handleScroll() {\n    console.log(window.scrollY);\n  }\n\n  fetchDishes() {\n    let restaurantId = this.props.restaurant.id\n    console.log(restaurantId);\n    base.get('dishes', {\n      context: this,\n      withIds: true,\n      withRefs: true,\n      query: (ref) => ref.where('restaurantId', '==', restaurantId),\n    }).then(data => {\n      this.processDishes(data)\n    }).catch(err => {\n      console.log(err);\n    })\n  }\n\n  processDishes(dishes) {\n    let families = []\n    _.each(dishes, function(dish) {\n      let family = dish.family\n      families.push(family)\n    })\n    if (families.length === dishes.length) {\n      const uniqueFamiles = _.uniq(families)\n      const groupedDishes = _.groupBy(dishes, 'family')\n      this.setState({\n        families: uniqueFamiles,\n        groupedDishes: groupedDishes,\n        dishes: dishes,\n        filteredDishes: dishes,\n      })\n    }\n  }\n\n  render() {\n\n    return (\n      <RestaurantWrapper>\n        <Head>\n          <title>What to eat at {this.props.restaurant.title} - {this.props.restaurant.address.street}, {this.props.restaurant.address.city}</title>\n          <link rel=\"stylesheet\" type=\"text/css\" charset=\"UTF-8\" href=\"https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.min.css\" />\n          <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick-theme.min.css\" />\n        </Head>\n        {this.props.restaurant.action === \"call\" &&\n          <ActionButton innerRef={this.actionButton} href={`tel: ${this.props.restaurant.phone}`}>\n            Call\n          </ActionButton>\n        }\n        {this.props.restaurant.action === \"reserve\" &&\n          <ActionButton innerRef={this.actionButton} target=\"black\" href={this.props.restaurant.reserve}>\n            Reserve\n          </ActionButton>\n        }\n        {this.props.restaurant.action === \"order\" &&\n          <ActionButton innerRef={this.actionButton} target=\"blank\" href={this.props.restaurant.order}>\n            Order\n          </ActionButton>\n        }\n        <Profile\n          title={this.props.restaurant.title}\n          cuisine={this.props.restaurant.cuisine}\n          priceRange={this.props.restaurant.price}\n          background=\"http://irishpubcompany.com/wp-content/uploads/2018/01/Four-650x400.jpg\"\n          address={this.props.restaurant.address.street} />\n        <Scroller>\n          <Search\n            dishes={this.state.dishes}\n            width={this.state.sticky ? `calc(100% - ${this.actionButton.current.offsetWidth} - 16px)` : '100%'}\n            handleExpandSearch={() => this.setState({ isSearching: true })}\n            handleCollapseSearch={() => this.setState({ isSearching: false })}\n            handleDishCardClick={(id, result) => this.setState({ activeDish: id, results: result })}/>\n          <DishCardsFilters>\n            <DishCardsFilter active={this.state.activeFilter === 'popular'} onClick={() => this.setState({ activeFilter: 'popular', filteredDishes: this.state.dishes })}>\n              Popular\n            </DishCardsFilter>\n            {this.state.families.map((family) =>\n              <DishCardsFilter\n                key={family}\n                active={this.state.activeFilter === _.lowerCase(family)}\n                onClick={() => this.setState({ activeFilter: _.lowerCase(family), filteredDishes: this.state.groupedDishes[family] })}>\n                  {_.upperFirst(family)}s\n                </DishCardsFilter>)\n            }\n          </DishCardsFilters>\n          <DishCards>\n            <PoseGroup>\n              {this.state.filteredDishes.map((dish) =>\n                <StyledPosedDishCard key={dish.id} onClick={() => this.setState({ activeDish: dish.id })}><DishCard dish={dish}/></StyledPosedDishCard>)\n              }\n            </PoseGroup>\n          </DishCards>\n\n        </Scroller>\n        <PoseGroup>\n          {this.state.activeDish !== \"\" &&\n            <StyledSwiperContainer key=\"0\">\n              <Swiper\n                dish={this.state.activeDish}\n                dishes={this.state.isSearching ? this.state.results : this.state.filteredDishes}\n                dishIndex={this.state.isSearching ?  _.findIndex(this.state.results, { id: this.state.activeDish }) :  _.findIndex(this.state.filteredDishes, { id: this.state.activeDish })}\n                title={this.state.isSearching ? 'results' : this.state.activeFilter}\n                isVisible={this.state.activeDish !== \"\"}\n                handleCollapse={() => this.setState({ activeDish: \"\" })}/>\n            </StyledSwiperContainer>\n          }\n        </PoseGroup>\n      </RestaurantWrapper>\n    );\n  }\n}\n\nexport default Restaurant;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAoBA;AAAA;AAAA;AAAA;AAmBA;AAAA;AAAA;AAAA;AASA;AAAA;AAAA;AAAA;AAaA;AAAA;AAAA;AAAA;AAKA;AAAA;AAIA;AAIA;AACA;AACA;AACA;AADA;AAGA;AACA;AADA;AAGA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAZA;AAkBA;AAAA;AAAA;AAAA;AAQA;AACA;AACA;AADA;AAGA;AACA;AADA;AAGA;AACA;AADA;AAPA;AAYA;AAAA;AAAA;AAAA;AACA;AAQA;;;;;AAEA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AAXA;AAYA;AACA;;;AAiBA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAJA;AAMA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;;;AAEA;AAAA;AACA;AACA;AAIA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AACA;AALA;AAQA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AALA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AADA;AAWA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AASA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AANA;AAYA;;;;;;;;;;;;AA5IA;AACA;AACA;;AACA;AACA;AACA;AAAA;AAAA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;;AATA;AASA;AACA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;AA9BA;AACA;AA8JA;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}